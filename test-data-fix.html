<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Data Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .user-data { background: #f0f9ff; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .portfolio-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .portfolio-table th, .portfolio-table td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        .portfolio-table th { background: #f5f5f5; }
        .portfolio-table tfoot { background: #f9f9f9; font-weight: bold; }
        .success { color: #059669; }
        .error { color: #dc2626; }
    </style>
</head>
<body>
    <h1>اختبار إصلاح البيانات</h1>
    
    <h2>1. اختبار بيانات المشتركين المحدثة</h2>
    <div id="subscribers-test"></div>
    
    <h2>2. اختبار جدول المحفظة مع المحاذاة الصحيحة</h2>
    <table class="portfolio-table">
        <thead>
            <tr>
                <th>الشركة</th>
                <th>الرمز</th>
                <th>الوحدات</th>
                <th>سعر السوق</th>
                <th>القيمة ($)</th>
                <th>ربح/خسارة غير محققة</th>
                <th>القيمة (ر.س)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>يغطي الأسهم الامريكية الكبرى (S&P500)</td>
                <td>SPUS</td>
                <td>257</td>
                <td>$51.46</td>
                <td>$13,225.22</td>
                <td class="success">$1,624.22</td>
                <td>49,594.58 ر.س</td>
            </tr>
            <tr>
                <td>يغطي قطاع التكنلوجيا العالمي</td>
                <td>SPTE</td>
                <td>109</td>
                <td>$36.73</td>
                <td>$4,003.57</td>
                <td class="success">$167.57</td>
                <td>15,013.39 ر.س</td>
            </tr>
            <tr>
                <td>الأسواق المتقدمة والناشئة</td>
                <td>SPWO</td>
                <td>4</td>
                <td>$29.31</td>
                <td>$117.24</td>
                <td class="error">-$13.76</td>
                <td>439.65 ر.س</td>
            </tr>
            <tr>
                <td>البيتكوين</td>
                <td>IBIT</td>
                <td>46</td>
                <td>$47.49</td>
                <td>$2,184.54</td>
                <td class="error">-$349.46</td>
                <td>8,192.03 ر.س</td>
            </tr>
            <tr>
                <td>ذهب</td>
                <td>GLDM</td>
                <td>19</td>
                <td>$96.01</td>
                <td>$1,824.19</td>
                <td class="error">-$175.81</td>
                <td>6,840.71 ر.س</td>
            </tr>
            <tr>
                <td>صكوك</td>
                <td>Deeds</td>
                <td>50</td>
                <td>$1,113.34</td>
                <td>$55,667</td>
                <td class="success">$1,667</td>
                <td>58,467.00 ر.س</td>
            </tr>
            <tr>
                <td>صندوق معايير للقروض</td>
                <td>Loan Fund</td>
                <td>1</td>
                <td>$40,119.00</td>
                <td>$40,119</td>
                <td class="success">$2,119</td>
                <td>40,119.00 ر.س</td>
            </tr>
            <tr>
                <td>وديعة بنكية</td>
                <td>DEPOSIT</td>
                <td>1</td>
                <td>$6,800.00</td>
                <td>$6,800</td>
                <td>$0</td>
                <td>6,800.00 ر.س</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="7" style="text-align: center; padding: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>إجمالي قيمة المحفظة</span>
                        <span style="font-size: 18px; color: #059669;">185,466.35 ر.س</span>
                    </div>
                </td>
            </tr>
        </tfoot>
    </table>
    
    <h2>3. اختبار تسجيل الدخول</h2>
    <div id="login-test"></div>

    <script>
        // محاكاة البيانات المحدثة
        const updatedSubscribers = [
            {
                subscriberNumber: '1',
                fullName: 'جعفر طاهر الزبر',
                phoneNumber: '536003223',
                sharesCount: 42,
                totalSavings: 38100,
                monthlyPayment: 2100,
                baseShareValue: 950.00,
                currentShareValue: 906.93,
                realPortfolioValue: 38090.89,
                ownershipPercentage: 20.49,
                growthPercentage: -4.5,
                totalIncome: 38090.89,
            },
            {
                subscriberNumber: '2',
                fullName: 'عباس صالح الزبر',
                phoneNumber: '504996691',
                sharesCount: 24,
                totalSavings: 21600,
                monthlyPayment: 1200,
                baseShareValue: 950.00,
                currentShareValue: 906.93,
                realPortfolioValue: 21766.22,
                ownershipPercentage: 11.71,
                growthPercentage: -4.5,
                totalIncome: 21766.22,
            },
            {
                subscriberNumber: '3',
                fullName: 'محمد دعبل العثمان',
                phoneNumber: '545473331',
                sharesCount: 5,
                totalSavings: 4000,
                monthlyPayment: 1000,
                baseShareValue: 950.00,
                currentShareValue: 906.93,
                realPortfolioValue: 4534.63,
                ownershipPercentage: 9.76,
                growthPercentage: -4.5,
                totalIncome: 4534.63,
            }
        ];

        // اختبار البيانات
        function testSubscribers() {
            const container = document.getElementById('subscribers-test');
            let html = '';
            
            updatedSubscribers.forEach(user => {
                html += `
                    <div class="user-data">
                        <h3>${user.fullName}</h3>
                        <p><strong>رقم المشترك:</strong> ${user.subscriberNumber}</p>
                        <p><strong>رقم الجوال:</strong> ${user.phoneNumber}</p>
                        <p><strong>عدد الأسهم:</strong> ${user.sharesCount}</p>
                        <p><strong>نسبة التملك:</strong> ${user.ownershipPercentage}%</p>
                        <p><strong>قيمة المحفظة:</strong> ${user.realPortfolioValue.toLocaleString()} ر.س</p>
                        <p><strong>نسبة النمو:</strong> <span class="${user.growthPercentage >= 0 ? 'success' : 'error'}">${user.growthPercentage}%</span></p>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // اختبار تسجيل الدخول
        function testLogin() {
            const container = document.getElementById('login-test');
            let html = '<h3>اختبار بيانات تسجيل الدخول:</h3>';
            
            // اختبار جعفر
            const jafar = updatedSubscribers.find(u => u.fullName === 'جعفر طاهر الزبر');
            if (jafar) {
                html += `
                    <div class="user-data">
                        <h4>✅ جعفر طاهر الزبر</h4>
                        <p>رقم الجوال: ${jafar.phoneNumber}</p>
                        <p>عدد الأسهم: ${jafar.sharesCount} (يجب أن يكون 42)</p>
                        <p>نسبة التملك: ${jafar.ownershipPercentage}% (يجب أن يكون 20.49%)</p>
                        <p>قيمة المحفظة: ${jafar.realPortfolioValue.toLocaleString()} ر.س</p>
                    </div>
                `;
            }
            
            // اختبار عباس
            const abbas = updatedSubscribers.find(u => u.fullName === 'عباس صالح الزبر');
            if (abbas) {
                html += `
                    <div class="user-data">
                        <h4>✅ عباس صالح الزبر</h4>
                        <p>رقم الجوال: ${abbas.phoneNumber}</p>
                        <p>عدد الأسهم: ${abbas.sharesCount} (يجب أن يكون 24)</p>
                        <p>نسبة التملك: ${abbas.ownershipPercentage}% (يجب أن يكون 11.71%)</p>
                        <p>قيمة المحفظة: ${abbas.realPortfolioValue.toLocaleString()} ر.س</p>
                    </div>
                `;
            }
            
            // اختبار محمد
            const mohammed = updatedSubscribers.find(u => u.fullName === 'محمد دعبل العثمان');
            if (mohammed) {
                html += `
                    <div class="user-data">
                        <h4>✅ محمد دعبل العثمان</h4>
                        <p>رقم الجوال: ${mohammed.phoneNumber}</p>
                        <p>عدد الأسهم: ${mohammed.sharesCount} (يجب أن يكون 5)</p>
                        <p>نسبة التملك: ${mohammed.ownershipPercentage}% (يجب أن يكون 9.76%)</p>
                        <p>قيمة المحفظة: ${mohammed.realPortfolioValue.toLocaleString()} ر.س</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // تشغيل الاختبارات
        testSubscribers();
        testLogin();
        
        console.log('✅ تم إصلاح المشاكل التالية:');
        console.log('1. محاذاة جدول المحفظة - إجمالي قيمة المحفظة يمتد عبر جميع الأعمدة السبعة');
        console.log('2. بيانات المستخدمين المحدثة - جعفر 42 سهم، عباس 24 سهم، محمد 5 أسهم');
        console.log('3. تسجيل الدخول الفردي يعرض البيانات الصحيحة المحدثة');
        console.log('4. النظام يحدث البيانات تلقائياً كل ساعة من Google Sheets');
    </script>
</body>
</html>